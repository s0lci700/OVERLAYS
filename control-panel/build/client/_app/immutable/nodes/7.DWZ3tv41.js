import"../chunks/DsnmJJEf.js";import{p as va,c as e,s as t,r as s,t as R,i as d,a as ha,N as Q,aK as Aa,aL as pa}from"../chunks/ab1WaRnl.js";import{s as o}from"../chunks/Cxuf-16e.js";import{a as v,f as h}from"../chunks/C0gwv_6f.js";import{i as X}from"../chunks/D5oBZPha.js";import{e as M,i as Ha,s as oa}from"../chunks/hbQhw9FI.js";import{s as La,a as ca}from"../chunks/BddI7m7i.js";import{S as ra,s as j,c as wa}from"../chunks/DKBTBH1p.js";var Da=h('<div class="dash-ability"><span class="dash-ability-label"> </span> <span class="dash-ability-value mono-num"> </span></div>'),Fa=h('<span class="dash-pill"> </span>'),Ia=h('<div class="dash-pill-row"></div>'),Ea=h('<p class="dash-empty">no definida</p>'),Ua=h('<div class="dash-resource"><span class="dash-resource-name"> </span> <span class="dash-resource-count mono-num"> </span> <span class="dash-resource-recharge"> </span></div>'),Wa=h('<div class="dash-resource-grid"></div>'),Ma=h('<p class="dash-empty">no definida</p>'),ja=h('<article class="dashboard-card card-base"><header class="dash-card-header"><img class="dash-photo" loading="lazy"/> <div class="dash-identity"><div class="dash-name-row"><span class="dash-name"> </span> <span class="dash-id"> </span></div> <span class="dash-player"> </span> <div class="dash-vitals"><div class="dash-vital"><span class="dash-vital-label">HP</span> <span class="dash-vital-value mono-num"> </span></div> <div class="dash-vital"><span class="dash-vital-label">Temp</span> <span class="dash-vital-value mono-num"> </span></div> <div class="dash-vital"><span class="dash-vital-label">AC</span> <span class="dash-vital-value mono-num"> </span></div> <div class="dash-vital"><span class="dash-vital-label">Vel</span> <span class="dash-vital-value mono-num"> </span></div></div></div></header> <section class="dash-section"><h3 class="dash-section-title">ATRIBUTOS</h3> <div class="dash-ability-grid"></div></section> <section class="dash-section"><h3 class="dash-section-title">CONDICIONES</h3> <!></section> <section class="dash-section"><h3 class="dash-section-title">RECURSOS</h3> <!></section></article>');function za(n,r){va(r,!0);const N=["/assets/img/barbarian.png","/assets/img/elf.png","/assets/img/wizard.png"],G=[{key:"str",label:"STR"},{key:"dex",label:"DEX"},{key:"con",label:"CON"},{key:"int",label:"INT"},{key:"wis",label:"WIS"},{key:"cha",label:"CHA"}],J={SHORT_REST:"descanso corto",LONG_REST:"descanso largo",TURN:"turno",DM:"DM"};function Z(a){if(!a){const i=N[Math.floor(Math.random()*N.length)];return`${ra}${i}`}return a.startsWith("http://")||a.startsWith("https://")||a.startsWith("data:")||a.startsWith("blob:")?a:a.startsWith("/")?`${ra}${a}`:`${ra}/${a.replace(/^\/+/,"")}`}function C(a){if(typeof a=="string"){const i=a.trim();return i||"no definida"}return"no definida"}function D(a){return Number.isFinite(a)?String(a):"no definida"}function Y(a,i){return!Number.isFinite(a)||!Number.isFinite(i)?"no definida":`${a}/${i}`}function V(a){const i=C(a?.condition_name);return i==="no definida"?i:Number.isFinite(a?.intensity_level)?`${i} Â· nivel ${a.intensity_level}`:i}function q(a){return!a||!Number.isFinite(a.pool_current)||!Number.isFinite(a.pool_max)?"no definida":`${a.pool_current}/${a.pool_max}`}function $(a){return J[a]||"no definida"}function P(){return(typeof r.character?.name=="string"?r.character.name.trim():"")||"personaje"}var F=ja(),T=e(F),I=e(T),B=t(I,2),E=e(B),l=e(E),c=e(l,!0);s(l);var p=t(l,2),m=e(p);s(p),s(E);var O=t(E,2),k=e(O);s(O);var y=t(O,2),A=e(y),x=t(e(A),2),K=e(x,!0);s(x),s(A);var H=t(A,2),U=t(e(H),2),_=e(U,!0);s(U),s(H);var b=t(H,2),W=t(e(b),2),ua=e(W,!0);s(W),s(b);var ta=t(b,2),ia=t(e(ta),2),ma=e(ia,!0);s(ia),s(ta),s(y),s(B),s(T);var aa=t(T,2),na=t(e(aa),2);M(na,21,()=>G,Ha,(a,i)=>{var u=Da(),f=e(u),g=e(f,!0);s(f);var S=t(f,2),L=e(S,!0);s(S),s(u),R(w=>{o(g,d(i).label),o(L,w)},[()=>D(r.character?.ability_scores?.[d(i).key])]),v(a,u)}),s(na),s(aa);var sa=t(aa,2),ba=t(e(sa),2);{var fa=a=>{var i=Ia();M(i,21,()=>r.character.conditions,u=>u.id,(u,f)=>{var g=Fa(),S=e(g,!0);s(g),R(L=>o(S,L),[()=>V(d(f))]),v(u,g)}),s(i),v(a,i)},ga=Q(()=>Array.isArray(r.character?.conditions)&&r.character.conditions.length),ya=a=>{var i=Ea();v(a,i)};X(ba,a=>{d(ga)?a(fa):a(ya,!1)})}s(sa);var la=t(sa,2),xa=t(e(la),2);{var Sa=a=>{var i=Wa();M(i,21,()=>r.character.resources,u=>u.id,(u,f)=>{var g=Ua(),S=e(g),L=e(S,!0);s(S);var w=t(S,2),ea=e(w,!0);s(w);var da=t(w,2),Ca=e(da,!0);s(da),s(g),R((Ta,Oa,ka)=>{o(L,Ta),o(ea,Oa),o(Ca,ka)},[()=>C(d(f)?.name),()=>q(d(f)),()=>$(d(f)?.recharge)]),v(u,g)}),s(i),v(a,i)},Na=Q(()=>Array.isArray(r.character?.resources)&&r.character.resources.length),Ra=a=>{var i=Ma();v(a,i)};X(xa,a=>{d(Na)?a(Sa):a(Ra,!1)})}s(la),s(F),R((a,i,u,f,g,S,L,w,ea)=>{oa(I,"src",a),oa(I,"alt",i),o(c,u),o(m,`#${f??""}`),o(k,`Jugador: ${g??""}`),o(K,S),o(_,L),o(ua,w),o(ma,ea)},[()=>Z(r.character?.photo||""),()=>`Foto de ${P()}`,()=>C(r.character?.name),()=>C(r.character?.id),()=>C(r.character?.player),()=>Y(r.character?.hp_current,r.character?.hp_max),()=>D(r.character?.hp_temp),()=>D(r.character?.armor_class),()=>D(r.character?.speed_walk)]),v(n,F),ha()}const Va=pa([]),_a=pa([]);Aa(Va,n=>n.length>0);const Ba=40;function z(n){_a.update(r=>{const N=[...r,{timestamp:Date.now(),...n}];return N.length>Ba&&N.shift(),N})}j.on("hp_updated",({character:n,hp_current:r})=>{z({type:"hp",label:`${n.name} HP`,value:`${r}/${n.hp_max}`,detail:"Health updated"})});j.on("resource_updated",({charId:n,resource:r})=>{z({type:"resource",label:`Character ${n} resource`,value:`${r.pool_current}/${r.pool_max}`,detail:`Updated ${r.name}`})});j.on("condition_added",({charId:n,condition:r})=>{z({type:"condition",label:"Condition added",value:r.condition_name,detail:n})});j.on("condition_removed",({charId:n,conditionId:r})=>{z({type:"condition",label:"Condition removed",value:r,detail:n})});j.on("rest_taken",({charId:n,type:r})=>{z({type:"rest",label:`Rest (${r})`,value:n,detail:"Resources restored"})});j.on("dice_rolled",n=>{z({type:"roll",label:`${n.characterName||n.charId} rolled`,value:`${n.rollResult}`,detail:`d${n.sides} + ${n.modifier??0}`})});var Ka=h('<div class="dashboard-empty"><p class="dashboard-empty-title">Sin personajes activos</p> <p class="dashboard-empty-subtitle">Crea personajes desde el panel de control o espera la sincronizacion.</p></div>'),Xa=h('<div class="dashboard-grid"></div>'),Ga=h('<span class="dashboard-log-detail"> </span>'),Ja=h('<li class="dashboard-log-item"><span class="dashboard-log-time"> </span> <div class="dashboard-log-body"><span class="dashboard-log-label"> </span> <span class="dashboard-log-value"> </span> <!></div></li>'),Ya=h('<span class="dashboard-log-detail"> </span>'),qa=h('<li class="dashboard-log-item"><span class="dashboard-log-time"> </span> <div class="dashboard-log-body"><span class="dashboard-log-label"> </span> <span class="dashboard-log-value"> </span> <!></div></li>'),Qa=h(`<section class="dashboard-shell"><header class="dashboard-header"><h1 class="dashboard-title">Dashboard de personajes</h1> <p class="dashboard-subtitle">Vista en vivo para mesa o pantalla principal. Campos vacios muestran "no
      definida".</p></header> <!> <section class="dashboard-meta"><div class="dashboard-log"><div class="dashboard-log-head"><h2 class="dashboard-log-title">Ultimas acciones</h2></div> <ul class="dashboard-log-list"></ul></div> <div class="dashboard-log"><div class="dashboard-log-head"><h2 class="dashboard-log-title">Ultimos dados</h2></div> <ul class="dashboard-log-list"></ul></div></section></section>`);function is(n,r){va(r,!0);const N=()=>ca(_a,"$history",J),G=()=>ca(wa,"$characters",J),[J,Z]=La();let C=Q(()=>N().filter(l=>l.type!=="roll").slice(-10).reverse()),D=Q(()=>N().filter(l=>l.type==="roll").slice(-10).reverse());function Y(l){try{return new Date(l).toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit"})}catch{return""}}var V=Qa(),q=t(e(V),2);{var $=l=>{var c=Ka();v(l,c)},P=l=>{var c=Xa();M(c,5,G,p=>p.id,(p,m)=>{za(p,{get character(){return d(m)}})}),s(c),v(l,c)};X(q,l=>{G().length===0?l($):l(P,!1)})}var F=t(q,2),T=e(F),I=t(e(T),2);M(I,21,()=>d(C),l=>l.timestamp,(l,c)=>{var p=Ja(),m=e(p),O=e(m,!0);s(m);var k=t(m,2),y=e(k),A=e(y,!0);s(y);var x=t(y,2),K=e(x,!0);s(x);var H=t(x,2);{var U=_=>{var b=Ga(),W=e(b,!0);s(b),R(()=>o(W,d(c).detail)),v(_,b)};X(H,_=>{d(c).detail&&_(U)})}s(k),s(p),R(_=>{o(O,_),o(A,d(c).label),o(K,d(c).value)},[()=>Y(d(c).timestamp)]),v(l,p)}),s(I),s(T);var B=t(T,2),E=t(e(B),2);M(E,21,()=>d(D),l=>l.timestamp,(l,c)=>{var p=qa(),m=e(p),O=e(m,!0);s(m);var k=t(m,2),y=e(k),A=e(y,!0);s(y);var x=t(y,2),K=e(x,!0);s(x);var H=t(x,2);{var U=_=>{var b=Ya(),W=e(b,!0);s(b),R(()=>o(W,d(c).detail)),v(_,b)};X(H,_=>{d(c).detail&&_(U)})}s(k),s(p),R(_=>{o(O,_),o(A,d(c).label),o(K,d(c).value)},[()=>Y(d(c).timestamp)]),v(l,p)}),s(E),s(B),s(F),s(V),v(n,V),ha(),Z()}export{is as component};
