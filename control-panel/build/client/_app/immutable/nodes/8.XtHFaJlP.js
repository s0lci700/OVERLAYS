import"../chunks/DsnmJJEf.js";import"../chunks/BcPgcvTn.js";import{p as ee,a0 as v,y,d as te,a as re,i as e,z as o,s as _,c as p,r as l,t as F,a1 as $}from"../chunks/BpRt2mh-.js";import{a as E,f as O}from"../chunks/CXy7eh0M.js";import{d as ae,s as S,a as oe}from"../chunks/CSeQF5Ga.js";import{i as se}from"../chunks/D5Mqzety.js";import{e as ne,a as ie}from"../chunks/6gtY402H.js";import{s as le}from"../chunks/CK5yDnZ6.js";import{a as ue,s as pe}from"../chunks/Ctf5viQA.js";import{P as de}from"../chunks/Dwc37TK4.js";import{c as ce,S as z}from"../chunks/Nz_3zEkQ.js";var fe=O("<p> </p>"),me=O('<article class="manage-card card-base"><header class="manage-card-head"><h3 class="manage-char-name"> </h3> <span class="manage-char-player"> </span></header> <!> <button class="btn-base manage-save-btn" type="button"> </button> <!></article>'),ge=O('<section class="character-management" aria-labelledby="manage-character-title"><div class="manage-header card-base"><h2 id="manage-character-title" class="manage-title">GESTIÓN DE FOTOS</h2> <p class="manage-subtitle">Preset or URL or Local File + drag & drop</p></div> <div class="manage-grid"></div></section>');function ve(U,b){ee(b,!0);const x=()=>ue(ce,"$characters",N),[N,D]=pe(),R=[{label:"Aleatorio",value:""},{label:"Barbarian",value:"/assets/img/barbarian.png"},{label:"Elf",value:"/assets/img/elf.png"},{label:"Wizard",value:"/assets/img/wizard.png"}];let d=v(y({})),c=v(y({})),f=v(y({})),m=v(y({})),s=v(y({})),a=v(y({}));function V(r){return!r||R.some(t=>t.value===r)?"preset":r.startsWith("data:")?"local":"url"}function w(r){const t=r.id;if(e(d)[t]!==void 0)return;const n=r.photo||"",u=V(n);o(d,{...e(d),[t]:u},!0),o(c,{...e(c),[t]:u==="preset"?n:""},!0),o(f,{...e(f),[t]:u==="url"?n:""},!0),o(m,{...e(m),[t]:u==="local"?n:""},!0),o(s,{...e(s),[t]:!1},!0),o(a,{...e(a),[t]:{type:"",text:""}},!0)}te(()=>{x().forEach(r=>w(r))});function G(r,t){o(d,{...e(d),[r]:t},!0),o(a,{...e(a),[r]:{type:"",text:""}},!0)}function W(r,t){o(c,{...e(c),[r]:t},!0)}function j(r,t){o(f,{...e(f),[r]:t},!0)}function H(r,t){o(m,{...e(m),[r]:t},!0)}function J(r,t){if(!t){e(a)[r]?.type==="error"&&o(a,{...e(a),[r]:{type:"",text:""}},!0);return}o(a,{...e(a),[r]:{type:"error",text:t}},!0)}function M(r){const t=e(d)[r]||"preset";return t==="local"?e(m)[r]||"":t==="url"?(e(f)[r]||"").trim():e(c)[r]||""}async function Z(r){if(!e(s)[r]){o(s,{...e(s),[r]:!0},!0),o(a,{...e(a),[r]:{type:"",text:""}},!0);try{if(!(await fetch(`${z}/api/characters/${r}/photo`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({photo:M(r)})})).ok){o(a,{...e(a),[r]:{type:"error",text:"No se pudo actualizar la foto."}},!0);return}o(a,{...e(a),[r]:{type:"success",text:"Foto actualizada."}},!0)}catch(t){console.error("Error updating photo",t),o(a,{...e(a),[r]:{type:"error",text:"Error de conexión al guardar."}},!0)}finally{o(s,{...e(s),[r]:!1},!0)}}}var C=ge(),T=_(p(C),2);ne(T,5,x,r=>r.id,(r,t)=>{var n=me(),u=p(n),k=p(u),q=p(k,!0);l(k);var B=_(k,2),K=p(B,!0);l(B),l(u);var A=_(u,2);{let h=$(()=>e(d)[e(t).id]||"preset"),g=$(()=>e(c)[e(t).id]||""),L=$(()=>e(f)[e(t).id]||""),I=$(()=>e(m)[e(t).id]||"");de(A,{title:"Foto: Preset or URL or Local File",get options(){return R},dense:!0,get source(){return e(h)},get presetValue(){return e(g)},get urlValue(){return e(L)},get localValue(){return e(I)},get serverUrl(){return z},onSourceChange:i=>G(e(t).id,i),onPresetChange:i=>W(e(t).id,i),onUrlChange:i=>j(e(t).id,i),onLocalChange:i=>H(e(t).id,i),onError:i=>J(e(t).id,i)})}var P=_(A,2),Q=p(P,!0);l(P);var X=_(P,2);{var Y=h=>{var g=fe(),L=p(g,!0);l(g),F(()=>{le(g,1,`manage-feedback ${e(a)[e(t).id].type}`),S(L,e(a)[e(t).id].text)}),E(h,g)};se(X,h=>{e(a)[e(t).id]?.text&&h(Y)})}l(n),F(()=>{ie(n,"data-char-id",e(t).id),S(q,e(t).name),S(K,e(t).player),P.disabled=e(s)[e(t).id],S(Q,e(s)[e(t).id]?"GUARDANDO...":"ACTUALIZAR FOTO")}),oe("click",P,()=>Z(e(t).id)),E(r,n)}),l(T),l(C),E(U,C),re(),D()}ae(["click"]);var ye=O('<section class="tab-panel"><!></section>');function ke(U){var b=ye(),x=p(b);ve(x,{}),l(b),E(U,b)}export{ke as component};
