import"../chunks/DsnmJJEf.js";import"../chunks/BjI-d_yl.js";import{p as xe,M as Q,U as Re,aA as ge,d as ye,m as Ae,i as t,a as Oe,c as s,s as c,L as _,r as i,aJ as De,t as C,N as W}from"../chunks/ab1WaRnl.js";import{a as u,f as R,t as J}from"../chunks/C0gwv_6f.js";import{d as Se,a as b,e as M,s as x}from"../chunks/Cxuf-16e.js";import{i as Z}from"../chunks/D5oBZPha.js";import{e as ee,r as $e}from"../chunks/hbQhw9FI.js";import{s as N}from"../chunks/CRAvAg1A.js";import{b as Ce}from"../chunks/CV7Gzqws.js";import{b as Ne}from"../chunks/bxKVI7mh.js";import{a as ae,s as Fe}from"../chunks/BddI7m7i.js";import{S as ke,l as we,c as te}from"../chunks/DKBTBH1p.js";import{a as re}from"../chunks/CGV0KQgZ.js";var Ee=R("<option> </option>"),Le=R('<button class="dice-btn"><span aria-hidden="true"></span> <span class="dice-label"> </span></button>'),Ve=R('<div><div class="roll-die-label"> </div> <div> </div> <div><!></div></div>'),He=R('<div class="dice-panel"><div class="char-selector"><label class="selector-label" for="char-select">PERSONAJE ACTIVO</label> <div class="select-wrap"><select id="char-select"></select> <span class="select-arrow" aria-hidden="true">▾</span></div></div> <div class="modifier-input"><label class="modifier-label" for="modifier">MODIFICADOR</label> <div class="modifier-stepper-cluster"><button class="modifier-stepper" aria-label="Reducir modificador">−</button> <input id="modifier" class="modifier-value" type="number" min="-20" max="20"/> <button class="modifier-stepper" aria-label="Aumentar modificador">+</button></div></div> <div class="dice-grid"><!> <button class="dice-btn d20-btn"><span class="dice-icon dice-icon--d20" aria-hidden="true"></span> <span class="dice-label">d20</span></button></div> <!></div>');function Te(F,h){xe(h,!0);const o=()=>ae(we,"$lastRoll",P),ie=()=>ae(te,"$characters",P),[P,se]=Fe();let g=Q(Re(ge(te)[0]?.id)),l=Q(0);const Y=-20,q=20,oe=250,le=80;let y=null,A=null,k=null;function ne(e){return Math.floor(Math.random()*e)+1}function ce(e){const a=Number(e);if(!Number.isFinite(a)){_(l,0);return}_(l,Math.max(Y,Math.min(q,a)),!0)}function de(){_(l,Math.min(q,t(l)+1),!0)}function ue(){_(l,Math.max(Y,t(l)-1),!0)}function v(){y&&(clearTimeout(y),y=null),A&&(clearInterval(A),A=null)}function U(e){v(),e(),y=setTimeout(()=>{A=setInterval(e,le)},oe)}async function j(e){let a=ne(e);const r={charId:t(g),result:a,modifier:t(l),sides:e};console.log("Sending payload:",r);const n=await fetch(`${ke}/api/rolls`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({charId:t(g),result:a,modifier:t(l),sides:e})});n.ok||console.error("Failed to log roll",n.status)}const O=W(()=>o()?.result===20&&o()?.sides===20),D=W(()=>o()?.result===1);function ve(e,a){k&&k.pause(),a&&(a.style.transform="scale(1)"),e.style.opacity="0",e.style.transform="translateY(12px)",re(e,{opacity:1,translateY:{from:12},duration:200,ease:"outCubic"}),a&&(k=re(a,{scale:{from:.3},duration:450,delay:70,ease:"outElastic(1, .6)"}))}ye(()=>{o()&&Ae().then(()=>{const a=document.querySelector(".roll-result"),r=document.querySelector(".roll-number");a&&ve(a,r)})});var w=He(),E=s(w),X=c(s(E),2),L=s(X);ee(L,5,ie,e=>e.id,(e,a)=>{var r=Ee(),n=s(r,!0);i(r);var p={};C(()=>{x(n,t(a).name),p!==(p=t(a).id)&&(r.value=(r.__value=t(a).id)??"")}),u(e,r)}),i(L),De(2),i(X),i(E);var V=c(E,2),z=c(s(V),2),I=s(z),S=c(I,2);$e(S);var $=c(S,2);i(z),i(V);var H=c(V,2),B=s(H);ee(B,16,()=>[4,6,8,10,12],e=>e,(e,a)=>{var r=Le(),n=s(r),p=c(n,2),f=s(p);i(p),i(r),C(()=>{N(n,1,`dice-icon dice-icon--d${a}`),x(f,`d${a??""}`)}),b("click",r,()=>j(a)),u(e,r)});var pe=c(B,2);i(H);var fe=c(H,2);{var me=e=>{var a=Ve();let r;var n=s(a),p=s(n);i(n);var f=c(n,2);let G;var _e=s(f,!0);i(f);var T=c(f,2);let K;var be=s(T);{var he=d=>{var m=J("¡CRÍTICO!");u(d,m)},Ie=d=>{var m=J("¡PIFIA!");u(d,m)},Me=d=>{var m=J();C(()=>x(m,o().characterName??o().charId)),u(d,m)};Z(be,d=>{t(O)?d(he):t(D)?d(Ie,1):d(Me,!1)})}i(T),i(a),C(()=>{r=N(a,1,"roll-result",null,r,{"is-crit":t(O),"is-fail":t(D)}),x(p,`D${o().sides??""}`),G=N(f,1,"roll-number",null,G,{crit:t(O),fail:t(D)}),x(_e,o().rollResult),K=N(T,1,"roll-label",null,K,{crit:t(O),fail:t(D)})}),u(e,a)};Z(fe,e=>{o()&&e(me)})}i(w),Ne(L,()=>t(g),e=>_(g,e)),b("pointerdown",I,()=>U(ue)),b("pointerup",I,v),M("pointerleave",I,v),M("pointercancel",I,v),M("blur",S,()=>ce(t(l))),Ce(S,()=>t(l),e=>_(l,e)),b("pointerdown",$,()=>U(de)),b("pointerup",$,v),M("pointerleave",$,v),M("pointercancel",$,v),b("click",pe,()=>j(20)),u(F,w),Oe(),se()}Se(["pointerdown","pointerup","click"]);var Je=R('<section class="tab-panel"><!></section>');function ea(F){var h=Je(),o=s(h);Te(o,{}),i(h),u(F,h)}export{ea as component};
