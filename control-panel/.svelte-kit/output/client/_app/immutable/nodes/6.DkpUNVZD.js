import"../chunks/DsnmJJEf.js";import"../chunks/BcPgcvTn.js";import{p as Ma,a0 as Q,y as Ra,aA as ya,d as ga,m as Aa,i as t,a as Oa,c as s,s as c,r as i,aJ as Da,z as _,t as C,a1 as W}from"../chunks/BpRt2mh-.js";import{a as u,f as R,t as J}from"../chunks/CXy7eh0M.js";import{d as Sa,a as b,e as x,s as M}from"../chunks/CSeQF5Ga.js";import{i as Z}from"../chunks/D5Mqzety.js";import{e as aa,r as $a}from"../chunks/6gtY402H.js";import{s as F}from"../chunks/CK5yDnZ6.js";import{b as Ca}from"../chunks/D3iX995e.js";import{b as Fa}from"../chunks/C7eVFner.js";import{a as ea,s as Na}from"../chunks/Ctf5viQA.js";import{S as ka,l as wa,c as ta}from"../chunks/Nz_3zEkQ.js";import{a as ra}from"../chunks/CGV0KQgZ.js";var Ea=R("<option> </option>"),La=R('<button class="dice-btn"><span aria-hidden="true"></span> <span class="dice-label"> </span></button>'),Va=R('<div><div class="roll-die-label"> </div> <div> </div> <div><!></div></div>'),Ha=R('<div class="dice-panel"><div class="char-selector"><label class="selector-label" for="char-select">PERSONAJE ACTIVO</label> <div class="select-wrap"><select id="char-select"></select> <span class="select-arrow" aria-hidden="true">▾</span></div></div> <div class="modifier-input"><label class="modifier-label" for="modifier">MODIFICADOR</label> <div class="modifier-stepper-cluster"><button class="modifier-stepper" aria-label="Reducir modificador">−</button> <input id="modifier" class="modifier-value" type="number" min="-20" max="20"/> <button class="modifier-stepper" aria-label="Aumentar modificador">+</button></div></div> <div class="dice-grid"><!> <button class="dice-btn d20-btn"><span class="dice-icon dice-icon--d20" aria-hidden="true"></span> <span class="dice-label">d20</span></button></div> <!></div>');function Ta(N,h){Ma(h,!0);const o=()=>ea(wa,"$lastRoll",P),ia=()=>ea(ta,"$characters",P),[P,sa]=Na();let y=Q(Ra(ya(ta)[0]?.id)),l=Q(0);const Y=-20,q=20,oa=250,la=80;let g=null,A=null,k=null;function na(a){return Math.floor(Math.random()*a)+1}function ca(a){const e=Number(a);if(!Number.isFinite(e)){_(l,0);return}_(l,Math.max(Y,Math.min(q,e)),!0)}function da(){_(l,Math.min(q,t(l)+1),!0)}function ua(){_(l,Math.max(Y,t(l)-1),!0)}function v(){g&&(clearTimeout(g),g=null),A&&(clearInterval(A),A=null)}function j(a){v(),a(),g=setTimeout(()=>{A=setInterval(a,la)},oa)}async function z(a){let e=na(a);const r={charId:t(y),result:e,modifier:t(l),sides:a};console.log("Sending payload:",r);const n=await fetch(`${ka}/api/rolls`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({charId:t(y),result:e,modifier:t(l),sides:a})});n.ok||console.error("Failed to log roll",n.status)}const O=W(()=>o()?.result===20&&o()?.sides===20),D=W(()=>o()?.result===1);function va(a,e){k&&k.pause(),e&&(e.style.transform="scale(1)"),a.style.opacity="0",a.style.transform="translateY(12px)",ra(a,{opacity:1,translateY:{from:12},duration:200,ease:"outCubic"}),e&&(k=ra(e,{scale:{from:.3},duration:450,delay:70,ease:"outElastic(1, .6)"}))}ga(()=>{o()&&Aa().then(()=>{const e=document.querySelector(".roll-result"),r=document.querySelector(".roll-number");e&&va(e,r)})});var w=Ha(),E=s(w),U=c(s(E),2),L=s(U);aa(L,5,ia,a=>a.id,(a,e)=>{var r=Ea(),n=s(r,!0);i(r);var p={};C(()=>{M(n,t(e).name),p!==(p=t(e).id)&&(r.value=(r.__value=t(e).id)??"")}),u(a,r)}),i(L),Da(2),i(U),i(E);var V=c(E,2),X=c(s(V),2),I=s(X),S=c(I,2);$a(S);var $=c(S,2);i(X),i(V);var H=c(V,2),B=s(H);aa(B,16,()=>[4,6,8,10,12],a=>a,(a,e)=>{var r=La(),n=s(r),p=c(n,2),f=s(p);i(p),i(r),C(()=>{F(n,1,`dice-icon dice-icon--d${e}`),M(f,`d${e??""}`)}),b("click",r,()=>z(e)),u(a,r)});var pa=c(B,2);i(H);var fa=c(H,2);{var ma=a=>{var e=Va();let r;var n=s(e),p=s(n);i(n);var f=c(n,2);let G;var _a=s(f,!0);i(f);var T=c(f,2);let K;var ba=s(T);{var ha=d=>{var m=J("¡CRÍTICO!");u(d,m)},Ia=d=>{var m=J("¡PIFIA!");u(d,m)},xa=d=>{var m=J();C(()=>M(m,o().characterName??o().charId)),u(d,m)};Z(ba,d=>{t(O)?d(ha):t(D)?d(Ia,1):d(xa,!1)})}i(T),i(e),C(()=>{r=F(e,1,"roll-result",null,r,{"is-crit":t(O),"is-fail":t(D)}),M(p,`D${o().sides??""}`),G=F(f,1,"roll-number",null,G,{crit:t(O),fail:t(D)}),M(_a,o().rollResult),K=F(T,1,"roll-label",null,K,{crit:t(O),fail:t(D)})}),u(a,e)};Z(fa,a=>{o()&&a(ma)})}i(w),Fa(L,()=>t(y),a=>_(y,a)),b("pointerdown",I,()=>j(ua)),b("pointerup",I,v),x("pointerleave",I,v),x("pointercancel",I,v),x("blur",S,()=>ca(t(l))),Ca(S,()=>t(l),a=>_(l,a)),b("pointerdown",$,()=>j(da)),b("pointerup",$,v),x("pointerleave",$,v),x("pointercancel",$,v),b("click",pa,()=>z(20)),u(N,w),Oa(),sa()}Sa(["pointerdown","pointerup","click"]);var Ja=R('<section class="tab-panel"><!></section>');function ae(N){var h=Ja(),o=s(h);Ta(o,{}),i(h),u(N,h)}export{ae as component};
