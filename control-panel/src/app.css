/**
 * DADOS & RISAS — Global Stylesheet & Design System
 * ==================================================
 * Central design tokens, CSS reset, typography utilities, shared component
 * bases, and the app shell layout for the Svelte control panel.
 *
 * Sections:
 *   1. DESIGN TOKENS     — Color palette, fonts, spacing, radii, transitions
 *   2. CSS RESET          — Box-model normalization, body defaults, scrollbars
 *   3. TYPOGRAPHY UTILS   — .font-display, .label-caps, .mono-num, .sr-only
 *   4. SHARED BASES       — .card-base, .btn-base (reused by CharacterCard, DiceRoller)
 *   5. APP SHELL LAYOUT   — .app-shell, .app-header, .app-main, .bottom-nav
 *
 * Brand palette:
 *   --red   #FF4D6A   Primary action / damage / critical
 *   --cyan  #00D4E8   Accent / healing / connection
 *   --purple #500DF5  Dice / d20 highlight
 *
 * Fonts:
 *   --font-display  "Bebas Neue"       — headings, labels, brand
 *   --font-script   "Dancing Script"   — brand ampersand ("& Risas")
 *   --font-mono     "JetBrains Mono"   — numbers, HP, dice results
 *   --font-ui       system-ui          — body text, form elements
 *
 * Usage: imported globally in App.svelte and main.js.
 * Component-specific CSS lives alongside each .svelte file
 * (CharacterCard.css, DiceRoller.css).
 */

/* shadcn-svelte infrastructure */
@import url("https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Dancing+Script:wght@700&family=JetBrains+Mono:wght@400;700&display=swap");
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

/* ═══════════════════════════════════════════════════
   DESIGN TOKENS
   ═══════════════════════════════════════════════════ */
:root {
  /* Core neutrals: base canvas and elevated surfaces. */
  --black: #000000;
  --black-card: #0d0d0d;
  --black-elevated: #1a1a1a;
  --white: #ffffff;
  --grey: #888888;
  --grey-dim: #333333;
  /* Brand accents: match overlay/control-panel semantics. */
  --red: #ff4d6a;
  --red-dim: rgba(255, 77, 106, 0.12);
  --cyan: #00d4e8;
  --cyan-dim: rgba(0, 212, 232, 0.12);
  --purple: #500df5;
  --purple-dim: rgba(80, 13, 245, 0.12);
  /* HP thresholds (used in CharacterCard + overlays). */
  --hp-healthy: #22c55e;
  --hp-injured: #f59e0b;
  --hp-critical: #ff4d6a;
  /* Dim / start colors for HP gradients (used as gradient start stop) */
  --hp-healthy-dim: #15803d;
  --hp-injured-dim: #b45309;
  --hp-critical-dim: #991b1b;
  /* Mid-opacity purple for borders */
  --purple-mid: rgba(80, 13, 245, 0.5);
  /* Half-step spacing for tight layouts */
  --space-half: 2px;
  /* Drop shadows preserve the pixel/retro accent style. */
  --shadow-card: 4px 4px 0px rgba(255, 255, 255, 0.05);
  --shadow-red: 3px 3px 0px #ff4d6a;
  --shadow-cyan: 3px 3px 0px #00d4e8;
  --shadow-purple: 4px 4px 0px #500df5;
  /* Font families align with the control panel brand. */
  --font-display: "Bebas Neue", "Impact", "Arial Black", sans-serif;
  --font-script: "Dancing Script", cursive;
  --font-mono: "JetBrains Mono", "Courier New", monospace;
  --font-ui: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  /* Spacing scale: 4px base for consistent rhythm. */
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 20px;
  --space-6: 24px;
  --space-8: 32px;
  --space-10: 40px;
  --space-12: 48px;
  /* Radii for cards, controls, and pill badges. */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-pill: 999px;
  /* Z-index scale: documented layer order. */
  --z-sidebar-backdrop: 30;
  --z-sidebar: 40;
  --z-nav: 50;
  --z-modal-backdrop: 60;
  --z-modal: 70;
  /* Opacity tokens for consistent translucency across UI. */
  --alpha-subtle: 0.04;
  --alpha-dim: 0.12;
  --alpha-medium: 0.35;
  --alpha-overlay: 0.65;
  --alpha-solid: 0.88;
  /* Motion presets to keep animations consistent. */
  --t-fast: 150ms ease;
  --t-normal: 250ms ease;
  --t-spring: 280ms cubic-bezier(0.34, 1.56, 0.64, 1);

  /* shadcn-svelte semantic aliases — point back to existing tokens */
  --background: var(--black);
  --foreground: var(--white);
  --card: var(--black-card);
  --card-foreground: var(--white);
  --popover: var(--black-elevated);
  --popover-foreground: var(--white);
  --primary: var(--cyan);
  --primary-foreground: var(--black);
  --secondary: var(--black-elevated);
  --secondary-foreground: var(--grey);
  --muted: var(--black-elevated);
  --muted-foreground: var(--grey);
  --accent: var(--purple);
  --accent-foreground: var(--white);
  --destructive: var(--red);
  --destructive-foreground: var(--white);
  --border: var(--grey-dim);
  --input: var(--black-elevated);
  --ring: var(--cyan);
  --radius: var(--radius-md);
}

/* shadcn @theme inline — maps semantic vars to Tailwind utility classes */
@theme inline {
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: var(--radius);
  --radius-lg: calc(var(--radius) + 4px);
  --radius-xl: calc(var(--radius) + 8px);
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* ═══════════════════════════════════════════════════
   CSS RESET
   ═══════════════════════════════════════════════════ */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  font-size: 16px;
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

body {
  /* Global canvas uses black to preserve OBS overlay continuity. */
  background: var(--black);
  color: var(--white);
  /* Enforce the control-panel UI font to override Tailwind/shadcn defaults */
  font-family: var(--font-ui) !important;
  line-height: 1.5;
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#app {
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
}

/* ========================================================================
   Font enforcement for shadcn / Tailwind interaction

   Some shadcn or Tailwind base styles can override the intended font
   stack. These rules make the design tokens the single source of truth
   for typography across the control panel while keeping headings and
   numeric UI elements using their brand fonts.
   ======================================================================== */
html,
body,
#app {
  font-family: var(--font-ui) !important;
}

/* Headings and compact labels use the display font */
h1,
h2,
h3,
h4,
h5,
h6,
.label-caps,
.skip-to-content {
  font-family: var(--font-display) !important;
}

/* Numeric UI uses the mono font for consistent alignment */
.hp-cur,
.hp-max,
.hp-sep,
.roll-number,
.stat-value,
.mono-num {
  font-family: var(--font-mono) !important;
}

/* Reaffirm monospace for inputs that display numeric values */
input[type="number"],
.amount-input,
.modifier-value {
  font-family: var(--font-mono) !important;
}

/* Skip-to-content link: visible only on keyboard focus for a11y. */
.skip-to-content {
  position: absolute;
  left: -999px;
  top: var(--space-2);
  z-index: 100;
  background: var(--black-elevated);
  color: var(--cyan);
  padding: var(--space-2) var(--space-4);
  border: 1px solid var(--cyan);
  border-radius: var(--radius-md);
  font-family: var(--font-display);
  font-size: 0.9rem;
  letter-spacing: 0.05em;
  text-decoration: none;
}

.skip-to-content:focus {
  left: var(--space-4);
}

button {
  /* Buttons are styled per-component; defaults keep them neutral. */
  cursor: pointer;
  border: none;
  background: none;
  font: inherit;
  color: inherit;
  -webkit-tap-highlight-color: transparent;
}

input {
  /* Inputs adopt component styling; defaults avoid browser chrome. */
  border: none;
  background: none;
  font: inherit;
  color: inherit;
  outline: none;
}

input[type="number"] {
  /* Hide native spinners; custom steppers provide interaction. */
  appearance: textfield;
  -moz-appearance: textfield;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  -webkit-appearance: none;
}

select {
  /* Reset native select for custom styling. */
  appearance: none;
  -webkit-appearance: none;
  font: inherit;
  cursor: pointer;
  border: none;
  background: none;
  color: inherit;
  outline: none;
}

/* Reusable styled select: dark elevated bg, grey border, chevron arrow. */
.selector {
  min-height: 44px;
  border: 1px solid var(--grey-dim);
  border-radius: var(--radius-md);
  padding: 0 var(--space-2) 0 var(--space-3);
  padding-right: 32px;
  background-color: var(--black-elevated);
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Cpath fill='%23888888' d='M4 6l4 4 4-4'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 8px center;
  background-size: 16px 16px;
  color: var(--white);
  font-family: var(--font-ui);
}

.selector:focus {
  border-color: var(--cyan);
  box-shadow: 0 0 0 1px var(--cyan-dim);
}

.selector[multiple] {
  min-height: 140px;
  padding: var(--space-2) var(--space-3);
  background-image: none;
}

h1,
h2,
h3 {
  font-weight: inherit;
  font-size: inherit;
}

a {
  text-decoration: none;
}

::-webkit-scrollbar {
  width: 2px;
}
::-webkit-scrollbar-track {
  background: var(--black);
}
::-webkit-scrollbar-thumb {
  background: var(--purple);
  border-radius: var(--radius-pill);
}

/* ═══════════════════════════════════════════════════
   TYPOGRAPHY UTILITIES
   ═══════════════════════════════════════════════════ */
.font-display {
  font-family: var(--font-display);
}
.font-mono {
  font-family: var(--font-mono);
}
.font-script {
  font-family: var(--font-script);
}

.label-caps {
  /* Small uppercase label used for form headings. */
  font-family: var(--font-display);
  font-size: 0.7rem;
  font-weight: 700;
  color: var(--grey);
  letter-spacing: 0.12em;
  text-transform: uppercase;
  line-height: 1;
}

/* Focus-visible helper for keyboard users (used across interactive controls) */
:where(
  .btn-damage,
  .btn-heal,
  .btn-rest,
  .dice-btn,
  .condition-pill,
  .stepper,
  .nav-tab
):focus-visible {
  outline: 2px solid var(--cyan);
  outline-offset: 2px;
}

.mono-num {
  /* Numeric emphasis for HP, rolls, and counters. */
  font-family: var(--font-mono);
  font-weight: 700;
  line-height: 1;
}

.sr-only {
  /* A11y: hide text visually while keeping it screen-reader accessible. */
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* ═══════════════════════════════════════════════════
   SHARED COMPONENT BASES
   ═══════════════════════════════════════════════════ */
.card-base {
  /* Shared card frame for CharacterCard and DiceRoller sections. */
  background: var(--black-card);
  border: 1px solid var(--grey-dim);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-card);
  padding: var(--space-4);
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.btn-base {
  /* Shared button base; color variants are applied per component. */
  font-family: var(--font-display);
  font-size: 1.1rem;
  letter-spacing: 0.04em;
  border-radius: var(--radius-md);
  min-height: 52px;
  border: 1px solid;
  transition:
    background var(--t-fast),
    color var(--t-fast),
    box-shadow var(--t-fast),
    transform var(--t-fast);
}

.btn-base:active {
  transform: translate(3px, 3px);
  box-shadow: none !important;
}

/* ── Selection preview pills (below multi-selects) ── */
.selection-pills {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-1);
}

.selection-pill {
  display: inline-flex;
  align-items: center;
  padding: 1px 8px;
  border-radius: var(--radius-pill);
  background: var(--cyan-dim);
  border: 1px solid rgba(0, 212, 232, 0.25);
  color: var(--cyan);
  font-family: var(--font-display);
  font-size: 0.65rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  white-space: nowrap;
}

.selection-count {
  color: var(--cyan);
  font-family: var(--font-mono);
  font-size: 0.7rem;
  margin-left: var(--space-1);
}

/* ═══════════════════════════════════════════════════
   APP SHELL LAYOUT
   ═══════════════════════════════════════════════════ */
.app-shell {
  /* App layout wrapper: header, main content, bottom nav. */
  display: flex;
  flex-direction: column;
  height: 100dvh;
  overflow: hidden;
  background: var(--black);
}

.app-header {
  /* Fixed top bar with brand and tab controls. */
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-3) var(--space-4);
  background: var(--black);
  border-bottom: 1px solid var(--grey-dim);
}

.brand-wordmark {
  /* Brand lockup: DADOS + & Risas styles. */
  display: flex;
  align-items: baseline;
  gap: var(--space-2);
}

.brand-block {
  font-family: var(--font-display);
  font-size: 1.75rem;
  color: var(--red);
  letter-spacing: 0.04em;
  line-height: 1;
}

.brand-script {
  font-family: var(--font-script);
  font-size: 1.25rem;
  color: var(--cyan);
  line-height: 1;
}

.header-meta {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.conn-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--grey-dim);
  transition:
    background var(--t-normal),
    box-shadow var(--t-normal);
}

.conn-dot.connected {
  background: var(--cyan);
  box-shadow: 0 0 8px var(--cyan);
}

.header-count {
  font-family: var(--font-mono);
  font-size: 0.75rem;
  color: var(--grey);
}

.header-menu {
  width: 34px;
  height: 34px;
  border: 1px solid var(--grey-dim);
  border-radius: var(--radius-sm);
  color: var(--grey);
  background: var(--black-elevated);
}

.header-menu:hover {
  color: var(--white);
  border-color: var(--grey);
}

.app-main {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-4);
  padding-bottom: calc(var(--space-4) + 68px);
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.tab-panel {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  animation: fadeUp var(--t-fast) ease;
}

/* Character cards: single column on small screens, two on medium+. */
.characters-grid {
  /* Masonry-style column layout: use CSS columns for variable height cards.
     Fallback to a single column on small screens. */
  display: block;
  column-gap: var(--space-3);
  /* Try to balance column heights to reduce large reflows when items change */
  -webkit-column-fill: balance;
  column-fill: balance;
}

/* Single column on mobile */
.characters-grid {
  column-count: 1;
}

/* Two columns at tablet+ */
@media (min-width: 640px) {
  .characters-grid {
    column-count: 2;
  }
}

/* Three columns at medium screens when there are 3+ cards */
@media (min-width: 768px) {
  .characters-grid.grid-three {
    column-count: 3;
  }
}

@keyframes fadeUp {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  width: 100%;
  z-index: var(--z-nav);
  flex-shrink: 0;
  display: flex;
  background: var(--black);
  border-top: 1px solid var(--grey-dim);
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

.nav-tab {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-1);
  padding: var(--space-3) 0;
  min-height: 56px;
  color: var(--grey);
  background: transparent;
  border-top: 2px solid transparent;
  transition:
    color var(--t-fast),
    background var(--t-fast),
    border-color var(--t-fast);
}

.nav-tab.active {
  color: var(--red);
  border-top-color: var(--red);
  background: rgba(255, 77, 106, 0.06);
}

.nav-tab:not(.active):hover {
  color: var(--white);
  border-top-color: var(--grey);
  background: rgba(255, 255, 255, 0.04);
}

.nav-icon {
  font-size: 1.25rem;
  line-height: 1;
}

.nav-label {
  font-family: var(--font-display);
  font-size: 0.8rem;
  letter-spacing: 0.06em;
  line-height: 1;
}

.page-title {
  font-family: var(--font-display);
  color: var(--cyan);
  font-size: 1.6rem;
  letter-spacing: 0.05em;
}

.management-placeholder {
  border-color: var(--purple);
  background: var(--purple-dim);
}

.management-title {
  font-family: var(--font-display);
  color: var(--purple);
  font-size: 1.2rem;
  letter-spacing: 0.06em;
}

.management-text {
  color: var(--grey);
  font-size: 0.95rem;
}

.sidebar-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  z-index: var(--z-sidebar-backdrop);
}

.app-sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: min(460px, 100vw);
  height: 100dvh;
  background: var(--black);
  border-right: 1px solid var(--grey-dim);
  padding: var(--space-4);
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  transform: translateX(-102%);
  transition: transform var(--t-normal);
  z-index: var(--z-sidebar);
  overflow-y: auto;
}

.app-sidebar.open {
  transform: translateX(0);
}

.app-sidebar-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.app-sidebar-title {
  font-family: var(--font-display);
  color: var(--white);
  font-size: 1.2rem;
  letter-spacing: 0.05em;
}

.app-sidebar-close {
  width: 34px;
  height: 34px;
  border: 1px solid var(--grey-dim);
  border-radius: var(--radius-sm);
  color: var(--grey);
  background: var(--black-elevated);
}

.app-sidebar-close:hover {
  color: var(--white);
  border-color: var(--grey);
}

.app-sidebar-link {
  width: 100%;
  min-height: 48px;
  border: 1px solid var(--grey-dim);
  border-radius: var(--radius-md);
  font-family: var(--font-display);
  letter-spacing: 0.05em;
  color: var(--grey);
  background: var(--black-card);
  text-align: center;
  padding: 0 var(--space-3);
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
}

.app-sidebar-link.active {
  color: var(--cyan);
  border-color: var(--cyan);
  background: var(--cyan-dim);
}

.app-sidebar-link:not(.active):hover {
  color: var(--white);
  border-color: var(--grey);
  background: rgba(255, 255, 255, 0.04);
}